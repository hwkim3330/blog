NXP GoldBox: Time-Sensitive Networking(TSN) 기능 구현 종합 가이드I. Executive Summary본 보고서는 NXP GoldBox 개발 플랫폼에서 IEEE Time-Sensitive Networking(TSN) 표준을 구현하는 방법에 대한 포괄적인 분석과 실행 가이드를 제공합니다. GoldBox는 서비스 지향 게이트웨이(SoG) 및 도메인 컨트롤러 애플리케이션을 위해 설계된 강력한 플랫폼이지만, 그 TSN 기능은 세 가지 핵심 하드웨어 구성 요소, 즉 S32G GMAC, S32G PFE, 그리고 SJA1110 이더넷 스위치에 분산되어 있습니다. 각 구성 요소의 역할과 한계를 이해하는 것이 성공적인 TSN 구현의 핵심입니다.본 분석의 핵심 내용은 다음과 같습니다.기능 분산 아키텍처: TSN 기능은 단일 칩에 집중되어 있지 않습니다.S32G GMAC (기가비트 이더넷 컨트롤러): 표준 리눅스 네트워킹 스택과 직접 통합되어 802.1Qbv (Time-Aware Shaper, TAS), 802.1Qbu (Frame Preemption), 802.1Qav (Credit-Based Shaper, CBS)와 같은 스케줄링 및 셰이핑 기능을 담당합니다.S32G PFE (패킷 포워딩 엔진): 네트워크 가속에 최적화되어 있으며, 주로 802.1AS (시간 동기화)와 같은 기능을 하드웨어 수준에서 처리하여 CPU 부하를 줄입니다.1SJA1110 이더넷 스위치: 독립적인 TSN 스위치로서, 802.1CB (Frame Replication and Elimination for Reliability, FRER)와 같은 고급 신뢰성 기능과 포트 기반의 복잡한 TSN 정책을 자체적으로 처리합니다.소프트웨어 스택의 이해: GoldBox의 TSN 기능을 온전히 활용하려면 여러 소프트웨어 계층을 이해해야 합니다. S32G의 GMAC/PFE 기능은 리눅스 커널 드라이버와 tc와 같은 표준 유틸리티로 제어되는 반면, SJA1110 스위치의 고급 기능(예: 802.1CB)은 별도의 구성 도구와 펌웨어 바이너리가 필요합니다.SJA1110 구성 워크플로우: SJA1110 스위치를 구성하는 것은 리눅스 커널 설정과 별개의 작업입니다. 사용자는 NXP에서 제공하는 SJA1110 Configuration Tool을 사용하여 스위치의 동작을 정의하는 바이너리 파일(sja1110_switch.bin)을 생성해야 합니다. 이 파일은 리눅스 부팅 시 SPI 인터페이스를 통해 스위치에 로드됩니다. 이는 S32 Design Studio와 직접적인 관련이 없는 프로세스이며, 리눅스 환경에서 스위치를 제어하는 표준적인 방법입니다.3본 보고서는 각 TSN 표준(802.1AS, 802.1Qav, 802.1Qbv, 802.1CB)에 대한 하드웨어 지원 매핑, 소프트웨어 구성 방법, 그리고 실제 구현 과정에서 발생하는 문제(예: tc filter와 taprio의 연동 오류, GMAC의 하드웨어 큐 제약)에 대한 구체적인 해결책을 단계별로 제시합니다.II. NXP GoldBox의 TSN 하드웨어 아키텍처 분석플랫폼의 TSN 기능을 완전히 활용하기 위해서는 각 하드웨어 구성 요소의 역할과 상호작용을 이해하는 것이 필수적입니다.S32G 프로세서의 이중 이더넷 서브시스템: GMAC 대 PFES32G 프로세서는 서로 다른 목적을 가진 두 개의 독립적인 이더넷 서브시스템을 내장하고 있습니다.패킷 포워딩 엔진 (PFE): PFE는 네트워크 가속을 위한 전용 코프로세서로, 대용량 라우팅, 브리징, 방화벽 처리와 같은 작업을 메인 CPU 코어로부터 오프로드하는 데 최적화되어 있습니다.6 PFE는 자체 펌웨어를 기반으로 동작하며8, 주로 802.1AS (시간 동기화)와 같은 가속화된 TSN 기능을 지원합니다.1기가비트 미디어 액세스 컨트롤러 (GMAC): GMAC은 표준 IEEE 802.3을 준수하는 이더넷 MAC으로, 리눅스 커널 드라이버에 의해 직접 제어됩니다. 이러한 구조 덕분에 운영체제 수준에서 정교한 제어가 필요한 802.1Qbv (TAS) 및 802.1Qav (CBS)와 같은 고급 스케줄링 기능을 구현할 수 있습니다.1통합된 SJA1110 TSN 이더넷 스위치의 역할GoldBox 플랫폼은 S32G 프로세서 외에도 NXP SJA1110이라는 강력한 멀티포트 TSN 스위치를 포함하고 있습니다.10 이 스위치는 S32G의 GMAC 및 PFE와는 별개인 제3의 네트워킹 도메인으로 이해해야 합니다. SJA1110은 시간 동기화, 셰이핑, 폴리싱뿐만 아니라 **802.1CB (FRER)**와 같은 프레임 복제 및 제거 기능을 포함한 포괄적인 TSN 기능 세트를 하드웨어에서 자체적으로 지원합니다. 이 기능들은 S32G 프로세서와 고속 내부 인터페이스(예: SGMII) 및 제어 인터페이스(SPI)를 통해 통신하며, SJA1110 전용 구성 도구를 통해 생성된 바이너리 파일로 설정해야 합니다.12하드웨어 수준 TSN 기능 매핑 및 제한 사항NXP GoldBox 플랫폼에서 공식적으로 지원하는 TSN 기능은 각 하드웨어 구성 요소에 따라 명확하게 구분됩니다.표 1: NXP GoldBox TSN 기능 지원 매트릭스 (하드웨어 구성 요소별)TSN 표준일반 명칭S32G GMAC 지원S32G PFE 지원SJA1110 스위치 지원필수 소프트웨어 구성 요소802.1QbvTAS (스케줄링)예아니요예리눅스 tc-taprio / SJA1110 구성 도구802.1QbuFPE (프레임 선점)예아니요예리눅스 tc-etf / SJA1110 구성 도구802.1QavCBS (셰이핑)예아니요예리눅스 tc-cbs / SJA1110 구성 도구802.1ASgPTP (시간 동기화)예예예리눅스 ptp4l, PFE 펌웨어, SJA1110 구성 도구802.1CBFRER (프레임 복제)아니요아니요예SJA1110 구성 도구 / AN12925802.1QciPSFP (스트림 필터링)아니요아니요예SJA1110 구성 도구주요 하드웨어 제약 사항:S32G의 GMAC 컨트롤러는 하드웨어적 이유로 첫 번째 전송 큐(Queue 0)에 대한 오프로딩을 지원하지 않습니다.5 따라서 CBS나 TAS와 같은 기능을 하드웨어 오프로드 모드로 사용할 때는 반드시 큐 0번을 피해 트래픽 클래스를 매핑해야 합니다.III. S32G 리눅스 환경에서의 TSN 기능 구성S32G의 GMAC에서 지원하는 TSN 기능은 리눅스에 내장된 tc (Traffic Control) 유틸리티를 통해 구성합니다.1. 802.1AS (시간 동기화) 구성시간 동기화는 대부분의 시간 민감형 애플리케이션의 기초가 됩니다. GMAC은 하드웨어 타임스탬핑을 지원하며, 표준 리눅스 linuxptp 패키지의 ptp4l 데몬을 사용하여 구성할 수 있습니다.5Bash# end0 인터페이스를 슬레이브로, Layer 2 전송을 사용하고 하드웨어 타임스탬핑을 활성화
ptp4l -i end0 -m -s -2 -H
2. 802.1Qav (Credit-Based Shaper) 구성CBS는 주로 AVB 트래픽을 위해 대역폭을 보장하는 데 사용됩니다.핵심 제약 사항: 하드웨어 오프로드(offload 1)를 사용할 경우, 반드시 큐 0번을 피해서 CBS를 적용해야 합니다.5구성 예제 (end0 인터페이스의 2번 큐에 67Mbps 대역폭 할당):BashIF=end0

# 1. MQPRIO를 사용하여 다중 큐 생성 및 우선순위 매핑
tc qdisc add dev $IF root handle 1: mqprio num_tc 5 map 1 1 2 3 4 queues 1@0 1@1 1@2 1@3 1@4

# 2. TC2 (1:3 핸들)에 CBS 적용. 하드웨어 오프로드(offload 1) 사용
#    큐 0번이 아닌 큐 2번에 적용하여 하드웨어 제약을 회피
tc qdisc replace dev $IF parent 1:3 cbs \
    idleslope 67000 sendslope -933000 offload 1
3. 802.1Qbv (Time-Aware Shaper) 구성TAS는 taprio qdisc를 통해 구현되며, 패킷 필터링을 위해서는 clsact qdisc와 연동해야 합니다.문제점: taprio qdisc는 필터를 직접 연결할 수 없어 Error: Class doesn't support blocks 오류가 발생합니다.해결책: clsact qdisc를 필터링을 위한 "고리"로 사용하고, flower 필터를 clsact에 연결하여 패킷의 우선순위를 변경합니다. taprio는 변경된 우선순위에 따라 패킷을 올바른 시간 제어 큐로 보냅니다.tc 명령어 스크립트 예제:BashDEV=end0

# 1. 기존 qdisc 및 clsact 초기화
tc qdisc del dev $DEV root 2>/dev/null |

| truetc qdisc del dev $DEV clsact 2>/dev/null || true# 2. taprio qdisc 설치 (하드웨어 오프로드 모드)
#    - flags 2: 하드웨어 오프로드 활성화 (clockid 생략 필요)
#    - queues 1@1...: 하드웨어 제약으로 큐 0번을 사용하지 않음
tc qdisc add dev $DEV root handle 100: taprio \
    num_tc 3 map 1 2 2 \
    queues 1@1 1@2 1@3 \
    base-time 0 \
    sched-entry S 0x02 1000000 \
    sched-entry S 0x04 1000000 \
    sched-entry S 0x08 1000000 \
    flags 2

# 3. 필터 연결을 위한 clsact qdisc 추가
tc qdisc add dev $DEV clsact

# 4. flower 필터를 clsact(parent ffff:)에 연결하여 패킷 우선순위 설정
tc filter add dev $DEV egress protocol ip parent ffff: prio 10 \
    flower ip_proto icmp ip_tos 0x20/0xff \
    action skbedit priority 1 # -> TC1 (map 규칙에 따라)
```
IV. SJA1110 스위치 구성: SDK, 펌웨어, 그리고 AN12925802.1CB (FRER)와 같은 고급 TSN 기능은 S32G의 리눅스 커널이 아닌, SJA1110 스위치 자체를 구성해야 합니다. 이는 SW32_RTD와는 완전히 다른 별개의 소프트웨어 스택을 통해 이루어집니다.SJA1110 구성 도구 및 펌웨어필요한 소프트웨어: SJA1110 스위치를 구성하기 위해서는 "SJA1110-EVM Configuration Tools" 라는 이름의 소프트웨어가 필요합니다.13 이 도구는 S32 Design Studio와는 별개이며, 주로 Python 기반 스크립트로 구성되어 스위치의 모든 테이블(VLAN, 포워딩, 802.1CB 규칙 등)을 정의하는 **바이너리 구성 파일(sja1110_switch.bin)**을 생성합니다.3다운로드 방법:NXP 공식 웹사이트(nxp.com)에 로그인합니다.SJA1110-EVM 평가 보드 페이지로 이동합니다.13"Design Resources" -> "Software" 섹션에서 **"SJA1110-EVM Configuration Tools"**를 찾습니다.참고: 과거에는 "SJA1110 RTM"이라는 용어가 사용되었으나, 현재는 "Configuration Tools"로 제공될 가능성이 높습니다. 이 도구는 무료이며 별도의 라이선스 키는 필요하지 않습니다.리눅스 환경에서의 SJA1110 구성 워크플로우고객님께서 사용하시는 리눅스 환경에서는 S32 Design Studio를 직접 사용할 필요가 없습니다. 워크플로우는 다음과 같습니다.구성 파일 생성: 개발용 PC에서 다운로드한 SJA1110 Configuration Tool을 사용하여 원하는 스위치 설정(VLAN, 포워딩 규칙, 802.1CB 설정 등)을 정의하고, 최종적으로 sja1110_switch.bin 파일을 생성합니다.펌웨어 배포: 생성된 sja1110_switch.bin 파일을 GoldBox의 리눅스 루트 파일 시스템 내 /lib/firmware/ 디렉토리에 복사합니다.5부팅 및 로드: GoldBox를 부팅하면, SJA1110 리눅스 드라이버(sja1110_spi)가 자동으로 /lib/firmware/ 경로에서 해당 바이너리 파일을 찾아 SPI 인터페이스를 통해 스위치에 로드하여 구성을 적용합니다.3이 방식은 리눅스 시스템에서 하드웨어 가속기를 위한 펌웨어를 로드하는 표준적인 방법이며, S32 Design Studio와 M7 코어용 RTD와는 독립적으로 동작합니다.AN12925 "SJA1110 Software Application Notes" 문서 정보요청하신 AN12925 문서는 802.1CB(FRER) 구성을 포함한 SJA1110의 고급 기능을 설정하는 데 필수적인 핵심 자료입니다.15접근 방법: 이 문서는 일반에 공개되어 있지 않으며 NDA(비밀유지협약)가 필요합니다. 문서를 얻기 위한 공식적인 절차는 다음과 같습니다.17NXP 웹사이트에 로그인합니다."My NXP Account" 메뉴로 이동합니다."Documentation" -> "Secure Files" 섹션으로 이동하여 접근 권한을 요청하거나 문서를 검색합니다.만약 접근이 불가능할 경우, NXP의 현지 FAE(Field Application Engineer) 또는 영업 담당자에게 연락하여 문서(AN12925, 문서번호 AH641610)에 대한 접근 권한을 요청해야 합니다.18이 문서는 SJA1110 구성 도구를 사용하여 802.1CB 관련 테이블(예: DPI, General Parameters)을 어떻게 설정해야 하는지에 대한 상세한 가이드를 제공합니다.15V. 결론 및 전략적 권장 사항NXP GoldBox의 TSN 기능을 마스터하기 위해서는 S32G 프로세서와 SJA1110 스위치의 역할을 명확히 구분하고, 각 기능에 맞는 올바른 도구를 사용해야 합니다.우선순위 조치 계획S32G GMAC 기능 구성: 802.1Qav(CBS) 및 802.1Qbv(TAS)와 같은 스케줄링/셰이핑 기능은 리눅스의 tc 명령어를 사용하여 end0 인터페이스에 직접 구성합니다. 이 때, 하드웨어 오프로드를 위한 큐 0번 제약과 taprio 필터링을 위한 clsact 사용법을 반드시 숙지해야 합니다.SJA1110 구성 도구 확보: 802.1CB(FRER)와 같은 스위치 고유 기능을 사용하기 위해, NXP 웹사이트에서 **"SJA1110-EVM Configuration Tools"**를 다운로드합니다.AN12925 문서 확보: NXP FAE 또는 NXP 포털의 "Secure Files"를 통해 AN12925 문서에 대한 접근 권한을 확보합니다. 이 문서는 802.1CB를 포함한 고급 기능 설정에 필수적입니다.구성 및 배포: 확보한 구성 도구를 사용하여 sja1110_switch.bin 파일을 생성하고, 이를 GoldBox의 /lib/firmware/ 디렉토리에 배포하여 리눅스 부팅 시 스위치에 적용되도록 합니다.이러한 체계적인 접근 방식을 통해 GoldBox 플랫폼이 제공하는 포괄적인 TSN 기능들을 성공적으로 활용할 수 있을 것입니다.
